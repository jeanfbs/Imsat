function download_image(a,b,c){var d="l_"+a+"_c_"+b+".png";$.ajax({type:"POST",async:!1,url:$("#form").attr("baseurl")+"/image",data:{nome:d,image:c.toDataURL("image/png"),dir:localStorage.getItem("tempDir")}})}function printMap(a,b){html2canvas([$("#map")[0]],{logging:!1,useCORS:!0,onrendered:function(c){download_image(a,b,c)}})}function initialize(){var a={center:new google.maps.LatLng(-18.9,-48.24),zoom:18,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.SATELLITE};map=new google.maps.Map(document.getElementById("map"),a)}function update(a,b,c){latlng=new google.maps.LatLng(a,b),map.setZoom(c),map.setCenter(latlng)}function resolveCordinate(a){var b=0,d=0,e=0;19==a.zoom?(b=.00127,d=.00135,e=2500):18==a.zoom?(b=.00254,d=.0027,e=2050):17==a.zoom?(b=.00508,d=.0054,e=1800):16==a.zoom&&(b=.0101,d=.0108,e=1700),salto_coluna=parseInt(Math.ceil(Math.abs(a.lng2-a.lng1)/d),10),salto_linha=parseInt(Math.ceil(Math.abs(a.lat2-a.lat1)/b),10),0==salto_coluna&&(salto_coluna=1),0==salto_linha&&(salto_linha=1);var f=parseFloat(100/(salto_coluna*salto_linha)),g=0,h=0;switch(getQuadrante(a)){case 1:console.log("Quandrante 1");break;case 2:console.log("Quandrante 2");break;case 3:console.log("Quandrante 3"),transporXY(a),g=a.lat1,h=a.lng1;var i=0,j=0;interval=setInterval(function(){if(i==salto_linha){clearInterval(interval),started=!1,$("#modal_status").modal("hide"),$("#pbar").attr("valuenow",100),$("#pbar").width("100%");var e="<h4><a href='"+$("#form").attr("baseurl")+"/temp/"+localStorage.getItem("tempDir")+".zip' download><i class='fa fa-download fa-fw' aria-hidden='true'></i>Baixar Zip</a></h4>";return $("#resultado").prepend(e),started}j>-1&&salto_coluna>j&&(update(g,h,a.zoom),l=i,c=j,value=parseFloat($("#pbar").attr("valuenow"))+f,$("#pbar").attr("valuenow",value),$("#pbar").width(value+"%"),a.lng1!=a.lng2&&(a.lng1<a.lng2?h+=d:h-=d)),j++,j==salto_coluna&&(h=a.lng1,a.lat1!=a.lat2&&(a.lat1<a.lat2?g+=b:g-=b),j=0,i++)},e);break;case 4:console.log("Quandrante 4");break;default:console.log("%cErro: A dist\xe2ncia das coordenadas de mapeamento \xe9 muito grande","color:red")}}function transporXY(a){a.lat1<a.lat2&&a.lng1>a.lng2?(aux=a.lat1,a.lat1=a.lat2,a.lat2=aux,aux=a.lng1,a.lng1=a.lng2,a.lng2=aux):a.lat1<a.lat2&&a.lng1<a.lng2?(aux=a.lat1,a.lat1=a.lat2,a.lat2=aux):a.lat1>a.lat2&&a.lng1>a.lng2&&(tmp=a.lng1,a.lng1=a.lng2,a.lng2=tmp)}function getQuadrante(a){return a.lat1>0&&a.lng1>0&&a.lat2>0&&a.lng2>0?1:a.lat1>0&&a.lng1<0&&a.lat2>0&&a.lng2<0?2:a.lat1<0&&a.lng1<0&&a.lat2<0&&a.lng2<0?3:a.lat1<0&&a.lng1>0&&a.lat2<0&&a.lng2>0?4:0}var started=!1,salto_coluna=0,salto_linha=0,interval,map,l=0,c=0;$(document).ready(function(){initialize(),$("#extrair").on("click",function(){started=!0,$("#pbar").attr("valuenow",0),$("#pbar").width("0%"),$("#resultado").empty(),localStorage.setItem("tempDir",(new Date).getTime());var a={};a.lat1=parseFloat($("#lat_start").val()),a.lng1=parseFloat($("#long_start").val()),a.lat2=parseFloat($("#lat_end").val()),a.lng2=parseFloat($("#long_end").val()),a.zoom=parseInt($("#zoom").val(),10),resolveCordinate(a)}),$("#cancel").on("click",function(){clearInterval(interval),started=!1,$("#pbar").attr("valuenow",0),$("#pbar").width("0%"),alertSucesso("A extra\xe7\xe3o foi cancelada!")}),$("#atualizar").on("click",function(){var a={};1==parseInt($("input[name=auto]:checked").val(),10)?(a.lat1=parseFloat($("#lat_start").val()),a.lng1=parseFloat($("#long_start").val())):(a.lat1=parseFloat($("#lat_end").val()),a.lng1=parseFloat($("#long_end").val())),a.zoom=parseInt($("#zoom").val(),10),update(a.lat1,a.lng1,a.zoom)}),google.maps.event.addListener(map,"tilesloaded",function(){started&&printMap(l,c)}),google.maps.event.addListener(map,"drag",function(){split=map.getCenter().toString().replace("(","").split(","),lat=parseFloat(split[0]),lng=parseFloat(split[1]),1==parseInt($("input[name=auto]:checked").val(),10)?($("#lat_start").val(lat.toFixed(4)),$("#long_start").val(lng.toFixed(4))):($("#lat_end").val(lat.toFixed(4)),$("#long_end").val(lng.toFixed(4)))})});